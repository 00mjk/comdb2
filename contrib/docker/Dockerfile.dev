FROM ubuntu:latest

ENV BUILD_DIR=/usr/src/comdb2
COPY . ${BUILD_DIR}

WORKDIR ${BUILD_DIR}

RUN apt-get update && \ 
    apt-get install -y sudo build-essential bison flex bc tcl               \
                           libprotobuf-c-dev libreadline-dev libsqlite3-dev \
                           libssl-dev libunwind-dev libz1 libz-dev          \
                           make gawk protobuf-c-compiler uuid-dev           \
                           liblz4-tool liblz4-dev libprotobuf-c1            \
                           libreadline6 libsqlite3-0 libuuid1 libz1         \
                           tzdata ncurses-dev libunwind8 liblz4-1 &&        \
     make &&  \
     make install

#    rm -fr ${BUILD_DIR} && \
#    dpkg -r tcl build-essential bison flex libprotobuf-c-dev libreadline-dev libsqlite3-dev libssl-dev libunwind-dev dpkg-dev make gawk protobuf-c-compiler uuid-dev liblz4-dev

ENV PATH      $PATH:/opt/bb/bin

COPY contrib/docker/docker-dev-entrypoint.sh /

ENTRYPOINT ["/docker-dev-entrypoint.sh"]
